import numpy as np
from scipy.special import erf

# 常数定义
Ns = 31
r1 = 42e-3  # 内径，单位为米
r2 = 146e-3  # 外径，单位为米
h = 20e-3  # 高度，单位为米
P = 101.325  # 压力，单位为千帕
# H = 375.28  # Henry常数，单位为 KPa*m3/mol
H = 709
l = 20e-3 / 3600  # 进液流量，从升每小时转换为立方米每秒
a = 500  # 填料比表面积，单位为 m^2/m^3
v = np.pi * (r2**2 - r1**2) * h  # 填料体积，单位为立方米
aa = a * v  # 截面积
L = l / aa  # 液相流速，单位为米每秒
k_noooh = 103.4  # 速率常数
D_no = 2.21e-9  # NO在溶液中的扩散系数，单位为 m^2/s
r = np.sqrt(r1 * r2)  # 几何平均半径，单位为米
gn2 = 2 / 3600  # 气体流量，单位为立方米每秒
y_in = 0.0005  # 进口气体的NO浓度
a1 = (1 - y_in) / y_in  # 计算吸收因子
a2 = a * np.pi * h * (r2**2 - r1**2) / gn2  # 计算吸收因子

# 数据定义
rpm = np.array([400, 600, 800, 400, 600, 800, 400, 600, 800, 1200, 1200, 1000, 1200, 1400, 400, 600, 800, 400, 600, 800, 400, 600, 800, 1200, 1200, 1200, 1200, 1000, 1000, 1000, 1000, 200, 400, 600, 800, 200, 400, 600, 800, 1000, 1200, 1000, 1200, 800, 1000, 1200, 1000, 1200, 200, 400, 200, 400, 600, 800, 1000, 1200, 1400, 756, 1203, 1411, 800, 1000, 1200, 1400, 200, 400, 700, 1000, 1200, 1400])
rpm1 = rpm / 800  # 无因次化转速
pH = np.array([11.73, 11.73, 11.73, 11.86, 11.86, 11.86, 12.01, 12.01, 12.01, 12.01, 12.5, 12.5, 12.5, 12.5, 13, 13, 13, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 13.5, 12.21, 12.21, 12.21, 12.21, 12.41, 12.41, 12.41, 12.41, 12.21, 12.21, 12.5, 12.5, 12.41, 13.5, 13.5, 13.5, 13.5, 12.81, 12.81, 13, 13, 13, 13, 13, 13, 11.88, 11.88, 11.88, 11.69, 11.69, 11.69, 11.69, 11.65, 11.65, 11.65, 11.65, 11.65, 11.65, 11.65])
ch2o2 = np.array([0.05, 0.05, 0.05, 0.1, 0.1, 0.1, 0.4, 0.4, 0.4, 0.4, 0.05, 0.1, 0.1, 0.1, 0.05, 0.05, 0.05, 0.1, 0.1, 0.1, 0.4, 0.4, 0.4, 0.05, 0.1, 0.2, 0.4, 0.05, 0.1, 0.2, 0.4, 0.6, 0.6, 0.6, 0.6, 0.7, 0.7, 0.7, 0.7, 0.6, 0.6, 0.6, 0.6, 0.7, 0.6, 0.6, 0.8, 0.8, 0.8, 0.8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])
y = np.array([0.357, 0.4864, 0.5512, 0.448, 0.5186, 0.5666, 0.7284, 0.7732, 0.7942, 0.8284, 0.47, 0.6213, 0.65, 0.6675, 0.437, 0.5664, 0.6312, 0.6678, 0.7395, 0.789, 0.768, 0.847, 0.895, 0.595, 0.81, 0.895, 0.935, 0.556, 0.765, 0.853, 0.899, 0.7812, 0.8602, 0.8832, 0.8968, 0.8032, 0.8914, 0.9032, 0.9133, 0.9132, 0.9178, 0.9207, 0.9269, 0.9069, 0.9568, 0.9639, 0.9589, 0.9687, 0.7636, 0.8712, 0.7345, 0.7856, 0.8093, 0.8312, 0.8968, 0.9236, 0.9312, 0.7578, 0.794, 0.8122, 0.6578, 0.7072, 0.729, 0.7532, 0.261, 0.403, 0.5636, 0.665, 0.6944, 0.7056])
y_out = 0.0005 * (1 - y)

# 计算不同pH值下的解离程度
al = 10 ** (11.73 - pH)
a = 1 / (1 + al)
# 计算氢过氧负离子浓度
ooh = ch2o2 * a
# 计算表观速率常数
k_appi = 103.4 * ooh
# 计算液膜更新时间
t_new = (r2 - r1) / (0.02107 * (L ** 0.2279) * (r * rpm) ** 0.5448 * Ns)
# 计算液膜传质系数
kl1 = (np.sqrt(D_no * k_appi) / t_new) * (t_new * erf(np.sqrt(k_appi * t_new)) + np.sqrt((t_new / np.pi) / k_appi) * np.exp(-k_appi * t_new) + (0.5 / k_appi) * erf(np.sqrt(k_appi * t_new)))
# 计算气膜传质系数
ky_cal = 0.082 * 298.15 * 0.2700 * kl1
# 计算气体吸收率
yno = 1 / (a1 * np.exp(a2 * ky_cal) + 1)

# 计算实验值与拟合值之间的误差
error = y_out - yno

print("yno:", yno)
print("error:", error)
